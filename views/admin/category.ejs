<%- include('../layouts/adminHeader') %>




<div class="alert alert-danger alert-dismissible fade show" role="alert" id="errorMessage" style="display: none;">
  <!-- Error message goes here -->
  <% if(typeof req !== 'undefined' && req.query.error) { %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert" id="errorMessage">
      <%= req.query.error %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% } %>
</div>
   

  <!-- Button to trigger modal -->
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
    Add New Category
  </button>

  <!-- Modal -->
<div class="modal fade" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addCategoryModalLabel">Add New Category</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        

        <!-- Form for adding category -->
        <form action="/admin/add-category" method="post">
          <div class="mb-3">
              <label for="categoryName" class="form-label">Category Name</label>
              <input type="text" class="form-control" id="categoryName" name="categoryName" required>
              <div class="modal-body">
                <div id="errorMessageDiv" class="text-danger"></div>
                <!-- Rest of the form and modal content -->
                   
            </div>
             
          </div>
          
      
          <div class="mb-3">
              <label for="categoryDescription" class="form-label">Category Description</label>
              <textarea class="form-control" id="categoryDescription" name="categoryDescription" rows="3" required></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Add Category</button>
      </form>
      </div> 
    </div>
  </div>
</div>

  <!-- responsive-table-for-the-category -->
  <div class="container-fluid pt-4 px-4">
    <div class="row g-4">
      <div class="col-12">
        <div class="bg-light rounded h-100 p-4">
          <h6 class="mb-4">Category</h6>
          <div class="table-responsive">
            <table class="table table-striped">
              <thead class="table-dark">
                <tr>
                  <th scope="col">#</th>

                  <th scope="col">Name</th>
                  <th scope="col">Description</th>
                  <th scope="col">Edit</th>
                </tr>
              </thead>
              <tbody>
                <% if(categoryData.length>0){
                  for(i=0;i<categoryData.length;i++) {%>
                    <tr>
                      <td>
                        <%=i+1%>
                      </td>

                      <td>
                        <%= categoryData[i].name.trim() %>
                      </td>

                      <td>
                        <%= categoryData[i].description.trim() %>

                      </td>
                      <% if(categoryData[i].status===true){%>

                        <td>
                          <a href="#confirmationPopUp" class="btn rounded-0 block-btn modalbtn" data-bs-toggle="modal"
                            data-id="<%= categoryData[i]._id  %>"
                            style="color:green; border: 1px solid green;">Listed</a>

                        </td>
                        <%}else{%>
                          <td>
                            <a href="#confirmationPopUp" data-id="<%= categoryData[i]._id %>" data-bs-toggle="modal"
                              class="btn rounded-0 unBlock-btn modalbtn"
                              style="color:red; border: 1px solid red;">Delisted</a>
                          </td>
                          <% }%>

                            <div class="modal fade" id="confirmationPopUp" tabindex="-1"
                              aria-labelledby="exampleModalLabel" aria-hidden="true">
                              <div class="modal-dialog">
                                <div class="modal-content">
                                  <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Are You Sure?</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                      aria-label="Close"></button>
                                  </div>
                                  <div class="modal-body">

                                    <%if(categoryData[i].status===true){%>
                                      <strong> Do you want to unlist the category ?</strong>
                                      <%}else{%>
                                        <strong> Do you want to list the category ?</strong>
                                        <%}%>
                                          <div class="modal-footer mt-2">
                                            <button type="button" class="btn btn-secondary"
                                              data-bs-dismiss="modal">Close</button>
                                            <a id="catconfirmBTN" class="btn btn-primary">Confirm</a>
                                          </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                    </tr>
                    <%}%>
                      <% } else { %>
                        <tr>
                          <td>
                            <% if (req.query.error) { %>
                              <%= req.query.error %>
                                <% } else { %>
                                  Category not found
                                  <% } %>
                          </td>
                        </tr>
                        <% } %>
              </tbody>
            </table>
          </div>
        </div>


      </div>
    </div>

    

    
<script>
  const addCategory = async () => {
    const categoryName = document.getElementById('categoryName').value.trim();
    const categoryDescription = document.getElementById('categoryDescription').value.trim();
    const errorMessageDiv = document.getElementById('errorMessageDiv'); // Updated ID

    var isError 

    try {
        const response = await fetch('/admin/add-category', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ categoryName, categoryDescription }),
        });

        const data = await response.json();

        if (response.ok) {
            
            window.location.href = '/admin/category';
        }else if(data.message) {
            // If there's an error, display the error message in the modal
            errorMessageDiv.textContent = 'Already exist'
        }
    } catch (error) {
        console.error('Error:', error);
    }
};

</script>



    <%- include('../layouts/adminFooter') %>